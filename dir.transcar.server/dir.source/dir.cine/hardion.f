      subroutine hardion(h,t,kp,eps,epx)
c
c           JGR,96, 5539-5547, APRIL 1991
c
      common/cnumber/fs0,fh0,fr0,fh1,fr1,fs2
      common/enumber/gs0,gh0,gr0,gh1,gr1,gs2

      real cr0(7,7),ch0(7,7),ch1(7,7),cs0(7,7),cr1(7,7),cs2(7,7)
      real sr0(7,7),sh0(7,7),sh1(7,7),ss0(7,7),sr1(7,7),ss2(7,7)
      real xr0(7,7),xh0(7,7),xh1(7,7),xs0(7,7),xr1(7,7),xs2(7,7)
      real yr0(7,7),yh0(7,7),yh1(7,7),ys0(7,7),yr1(7,7),ys2(7,7)
      real h,t

      xnlimeq=8.32e3*10**(0.157*kp)
      xnlimeq=log10(xnlimeq)
      xelimeq=4.17e2*10**(0.126*kp)
      xelimeq=log10(xelimeq)
c
c     limites "poleward" inversees par rapport a l'article:
c
      xelimpo=log10(6.31e5)
      xnlimpo=log10(1.41e5)

      data (( cr0(j,i), i=1,7), j=1,7)/
     &          6.0735,5.9053,6.0361,6.1780,6.3494,6.6795,6.7626,
     &          0.0676,-.0968,-.0678,-.0882,-.2118,0.0648,0.1270,
     &          0.0385,-.1870,-.1055,-.0426,0.0994,0.1286,0.0498,
     &          -.1086,-.0312,-.0897,-.0209,-.0700,-.2036,-.0840,
     &          0.0628,0.1165,0.0778,0.0901,0.1407,0.0569,0.0571,
     &          0.0328,0.0121,0.0810,-.0289,-.0696,-.0254,0.0166,
     &          0.0024,-.0780,-.0205,-.0410,-.0569,-.0191,-.0725/

      data (( sr0(j,i), i=1,7), j=1,7)/7*0.,
     &          -.0827,-.0299,0.0982,0.1380,0.1358,0.1736,0.0906,
     &          0.0807,-.1102,-.1030,-.1267,-.0699,-.0362,-.0425,
     &          -.0765,-.0316,-.0595,-.0104,-.0071,0.0325,0.0326,
     &          0.0139,0.0725,0.0275,0.0462,0.0191,-.0015,-.0600,
     &          0.0504,-.0025,0.0013,0.0079,-.0522,-.0217,0.0066,
     &          -.0349,-.0375,-.0259,0.0016,-.0029,0.0029,-.0168/

      data (( ch0(j,i), i=1,7), j=1,7)/
     &          70.7046,68.4378,67.2679,66.3658,65.1123,65.2640,62.6294,
     &          -4.7347,-4.7863,-5.1353,-5.4131,-5.9637,-4.5485,-3.1127,
     &          0.2563,-.2791,0.2245,0.6646,1.3884,2.0447,2.0641,
     &          -.6619,-.2775,-.4851,-.1186,-.3390,-1.2831,-1.0180,
     &          0.3734,0.7060,0.4831,0.5571,0.7818,0.1651,0.6589,
     &          0.1372,0.1687,0.4403,-.0202,-.0011,0.4365,-.4474,
     &          0.2540,-.1160,0.0088,-.1706,-.2468,-.1781,0.3518/

      data (( sh0(j,i), i=1,7), j=1,7)/7*0.,
     &          -.4069,0.3443,1.0373,1.5347,1.6492,2.4377,3.0632,
     &          0.4940,-.6511,-.9109,-1.2035,-1.1400,-.4969,-1.4825,
     &          -.3480,0.0299,-.2820,0.0752,-.0055,0.2676,1.3137,
     &          0.1891,0.2290,0.1571,0.2787,0.0905,0.2652,-.3794,
     &          0.0758,0.2316,0.0356,0.0108,-.2494,-.1594,-.6190,
     &          -.2143,-.1297,-.1248,0.0704,0.0425,0.0634,0.9286/

      data (( ch1(j,i), i=1,7), j=1,7)/
     &          74.3607,72.9747,71.9932,70.8355,70.0659,71.6299,72.6673,
     &          -5.4569,-6.5478,-6.3695,-6.8637,-7.8081,-5.5767,-.9404,
     &          -1.0669,-1.5595,-.8987,-.8136,0.3630,0.5242,1.8835,
     &          -1.0037,-.4611,-.0985,0.8564,0.9560,-.8137,-1.1484,
     &          0.5601,1.1429,0.8770,0.7227,0.4954,0.0542,-.3514,
     &          0.0772,0.3651,0.1219,-.1785,-.9646,0.3245,1.3156,
     &          -.0520,-.0515,-.5220,-.4841,0.1221,-.6756,1.1227/
      data (( sh1(j,i), i=1,7), j=1,7)/7*0.,
     &          0.2668,-.6087,0.6313,0.7320,-.2820,1.9135,1.4844,
     &          0.2659,-.3428,0.2883,0.1830,0.5412,0.2052,-.9121,
     &          -.6087,0.0311,-.3917,-.2095,-.2018,-1.4787,0.5804,
     &          -.0287,0.5542,0.3682,0.0304,-.0819,0.7552,0.0158,
     &          -.2828,-.0589,0.4207,0.1931,-.0501,-.4954,-.6696,
     &          0.0979,0.1164,0.0895,0.1581,0.3234,-.8850,-.6205/

      data (( cs0(j,i), i=1,7), j=1,7)/
     &          0.5626,0.4932,0.4526,0.3931,0.3620,0.2999,0.2483,
     &          0.4117,0.3379,0.2446,0.1736,0.0512,0.0348,-.0198,
     &          0.1073,0.0922,0.0198,-.0154,-.0494,-.0221,0.0155,
     &          0.0723,0.0800,0.0584,0.0490,0.0014,0.0086,-.0059,
     &          0.0195,0.0259,0.0067,0.0028,0.0031,-.0153,-.0030,
     &          0.0133,0.0174,-.0112,0.0012,-.0407,-.0080,-.0208,
     &          -.0056,0.0172,0.0111,0.0227,0.0170,0.0122,-.0048/
      data (( ss0(j,i), i=1,7), j=1,7)/7*0.,
     &          0.0426,-.0303,-.0777,-.1220,-.1449,-.0765,-.0504,
     &          0.0263,-.0164,0.0298,0.0030,-.0081,0.0041,0.0126,
     &          -.0529,-.0026,0.0314,-.0207,-.0108,-.0182,-.0227,
     &          -.0852,-.0027,-.0188,-.0323,-.0411,-.0173,-.0003,
     &          -.0464,0.0270,0.0191,0.0367,0.0174,0.0247,-.0038,
     &          0.0027,0.0374,0.0286,0.0252,0.0054,-.0106,0.0197/

      data (( cr1(j,i), i=1,7), j=1,7)/
     &          6.5688,6.5363,6.6232,6.6621,6.6308,6.5068,6.4243,
     &          -.2088,-.1385,-.0767,-.0313,0.1117,0.0845,-.1965,
     &          0.0649,0.0899,0.1221,0.1492,0.0932,0.0650,-.0416,
     &          -.0137,-.0495,-.0613,-.1051,-.1282,-.0421,-.0525,
     &          0.0913,0.0484,0.0321,0.0476,0.0214,0.0565,0.0967,
     &          -.0705,-.0587,-.0655,-.0272,0.0196,-.0135,-.0997,
     &          0.0527,0.0629,0.0420,0.0267,-.0080,0.0524,-.0721/
      data (( sr1(j,i), i=1,7), j=1,7)/7*0.,
     &          0.0111,0.0773,0.0386,0.0622,0.1368,0.0159,0.0337,
     &          -.0395,-.0316,-.0196,-.0125,-.0775,-.0625,-.0452,
     &          -.0093,-.0175,0.0272,0.0220,0.0207,0.1157,-.0584,
     &          0.0059,-.0137,0.0092,0.0127,-.0046,-.0579,-.0133,
     &          -.0060,0.0082,-.0136,-.0353,-.0062,0.0446,0.0830,
     &          0.0080,0.0326,0.0013,0.0119,0.0002,0.0532,-.0014/

      data (( cs2(j,i), i=1,7), j=1,7)/
     &          -.1834,-.1651,-.1559,-.1518,-.1510,-.1744,-.1828,
     &          0.0849,0.0561,0.0439,0.0504,0.0632,0.0990,0.0678,
     &          -.0586,-.0460,-.0345,-.0265,-.0180,-.0354,-.0577,
     &          -.0072,-.0140,-.0068,-.0184,-.0162,0.0098,0.0283,
     &          -.0295,-.0259,-.0158,-.0043,0.0043,-.0149,-.0124,
     &          0.0087,0.0163,0.0141,0.0093,0.0107,-.0003,0.0064,
     &          -.0136,-.0073,0.0000,-.0053,-.0075,0.0107,-.0102/
      data (( ss2(j,i), i=1,7), j=1,7)/7*0.,
     &          0.0021,0.0000,-.0080,-.0062,0.0182,-.0187,0.0012,
     &          -.0055,-.0049,0.0037,0.0011,-.0157,0.0022,0.0267,
     &          -.0002,-.0040,0.0029,-.0042,0.0009,0.0410,0.0041,
     &          -.0032,-.0084,-.0047,0.0004,0.0182,-.0204,-.0027,
     &          0.0033,0.0061,-.0046,0.0050,-.0127,-.0081,0.0036,
     &          -.0105,-.0079,0.0126,-.0061,0.0092,0.0175,0.0240/

      data (( xr0(j,i), i=1,7), j=1,7)/
     &          5.7511,5.8306,6.3941,6.2357,6.3981,6.6518,7.4840,
     &          1.1791,0.9214,0.8898,0.6770,0.2132,0.0721,0.9338,
     &          -.0659,-.0493,-.3394,-.4664,-.2670,-.1840,-.3816,
     &          0.1093,-.1558,0.0462,-.0469,0.0959,0.1949,-.0695,
     &          0.1002,0.0838,-.0170,0.0224,0.0948,0.0344,0.1002,
     &          -.1388,-.0549,-.1832,-.1516,0.0139,-.1279,-.0874,
     &          -.1005,-.0631,0.0995,0.0271,0.0373,0.0164,0.0058/
      data (( yr0(j,i), i=1,7), j=1,7)/7*0.,
     &          0.3902,0.8792,0.0458,0.1812,-.3711,-.0920,-.1541,
     &          0.2499,-.1005,-.0485,0.4295,0.1387,0.1932,0.1115,
     &          -.1009,0.0813,0.1351,-.0609,-.4767,0.0452,-.0186,
     &          -.1014,-.0395,0.0846,0.2810,0.1359,0.2531,-.0522,
     &          -.0703,0.0328,-.0295,-.1924,-.0397,-.0400,0.0235,
     &          -.0257,0.0428,-.0983,0.0480,-.1453,-.1101,-.0627/

      data (( xh0(j,i), i=1,7), j=1,7)/
     &          67.4756,65.8537,65.0188,63.6903,61.7691,61.0858,61.4745,
     &          -1.7068,-1.7336,-2.1418,-2.3486,-4.1102,-3.8113,-1.0330,
     &          -.5087,-.9556,-.8018,-.5513,-.3000,0.9485,0.0337,
     &          0.1568,0.2097,0.3105,0.2198,0.5408,0.4178,-1.7417,
     &          0.4064,0.1746,0.0190,-.1017,0.7203,-.0165,1.0161,
     &          -.4022,0.2800,-.2340,-.0532,0.2881,-.2311,-.0204,
     &          -.2477,-.0185,0.3475,0.1147,0.0871,-.1698,-.3218/
      data (( yh0(j,i), i=1,7), j=1,7)/7*0.,
     &          0.7069,2.0586,1.5878,2.1816,1.1527,2.7137,2.8077,
     &          0.1828,-.5218,-.8014,-.0053,-1.1598,-.7834,-.2483,
     &          0.2300,0.2187,0.2053,-.0484,-1.4005,-.1720,.3303,
     &          -.5579,-.2289,0.0865,0.5830,-.0378,0.8853,0.3713,
     &          0.1837,0.1700,0.0447,-.2247,-.1296,0.2123,-.1971,
     &          0.0979,0.2124,-.2953,0.2563,-.1340,-.2201,0.4691/

      data (( xh1(j,i), i=1,7), j=1,7)/
     &          73.9120,72.3306,72.0568,70.1774,68.5769,67.8985,76.3270,
     &          -5.0821,-5.5504,-4.8412,-6.2159,-5.8160,-6.6252,1.1911,
     &          -.0316,0.1021,0.6565,0.1652,0.8990,0.2066,0.2322,
     &          0.1626,0.0737,0.6312,0.7147,0.2507,0.5874,-1.2274,
     &          0.9433,0.3974,0.4389,0.2763,0.0440,0.4289,0.1598,
     &          -.3526,-.1684,-.2156,-.4385,-.5393,0.3884,-.3654,
     &          0.0544,0.1947,0.2110,0.0514,0.4974,0.2445,-.1122/
      data (( yh1(j,i), i=1,7), j=1,7)/7*0.,
     &          0.6570,0.7909,0.2083,0.7639,1.0285,1.2924,1.4314,
     &          0.0486,0.2047,-.0295,0.8098,0.1031,-.2050,2.9245,
     &          -.5530,-.8707,0.3723,0.3498,-.5264,-.0715,0.9907,
     &          -.3018,-.3851,0.5534,-.0037,0.0298,1.0292,0.0429,
     &          -.0243,0.5390,0.0464,0.2868,-.0862,-.3239,-.0725,
     &          0.0164,0.5290,-.0738,0.3650,0.3609,-.4850,-.3150/

      data (( xs0(j,i), i=1,7), j=1,7)/
     &          1.6926,1.7459,1.2547,1.3190,1.1444,0.9525,0.7083,
     &          -.0322,0.0086,0.1102,-.2011,0.0098,-.0354,-.5087,
     &          0.1387,-.0252,0.2185,0.0418,-.1496,0.1288,0.3716,
     &          0.0694,0.2836,0.1843,0.1837,-.0439,-.0501,-.0224,
     &          -.0633,-.0047,0.0298,-.0245,0.0286,0.0374,-.0097,
     &          0.0547,0.0082,0.0953,0.0309,-.2211,0.0301,0.0285,
     &          0.0523,-.0288,0.0596,-.0421,0.0842,-.0137,0.0361/
      data (( ys0(j,i), i=1,7), j=1,7)/7*0.,
     &          -.4330,-.9313,-.3183,-.3473,-.0270,-.4044,-.2429,
     &          -.1219,0.4387,0.1579,0.2043,0.0545,0.0729,0.2706,
     &          0.0436,-.2428,-.1712,0.0164,-.0133,-.1239,-.2187,
     &          -.0579,-.0396,-.0004,-.0632,-.1336,0.0341,0.1065,
     &          -.0483,-.1407,-.0858,0.0118,0.0585,-.0703,-.0120,
     &          0.0119,0.0661,-.0039,0.0589,0.1615,0.0357,0.0252/

      data (( xr1(j,i), i=1,7), j=1,7)/
     &          7.1132,7.3263,7.4225,7.5916,7.6866,7.7154,6.9225,
     &          0.0355,0.2147,0.1676,0.3006,0.4057,0.4498,-.1453,
     &          -.0584,0.0033,-.0946,-.0036,-.0630,-.0909,0.0171,
     &          -.0314,0.0165,-.0459,-.0604,0.0482,-.0944,0.1445,
     &          -.0218,-.0218,-.0332,0.0113,0.0579,0.0522,0.0225,
     &          -.0026,-.0252,-.0151,0.0215,0.0047,-.0113,0.0189,
     &          0.0338,0.0204,-.0123,0.0197,-.0082,0.0458,0.0077/
      data (( yr1(j,i), i=1,7), j=1,7)/7*0.,
     &          -.0594,-.0895,-.0820,-.0859,-.1168,-.0398,0.0110,
     &          0.0018,-.0035,0.0052,-.0004,0.0053,0.0440,-.2730,
     &          0.0337,0.0193,-.0638,-.0316,0.0287,0.0510,-.1641,
     &          0.0241,0.0183,-.0222,0.0445,0.0086,-.0544,-.0204,
     &          0.0250,-.0290,-.0143,0.0052,0.0067,0.0559,0.0472,
     &          0.0321,-.0073,0.0023,-.0093,0.0049,0.0127,0.0097/

      data (( xs2(j,i), i=1,7), j=1,7)/
     &          -.1758,-.1818,-.1789,-.1814,-.1537,-.1591,-.3192,
     &          0.0123,-.0013,0.0145,0.0364,0.0158,0.0414,0.0690,
     &          -.0447,-.0245,-.0182,-.0100,-.0091,-.0064,-.0523,
     &          -.0132,-.0118,-.0070,-.0154,0.0014,0.0045,-.0354,
     &          -.0212,0.0106,0.0014,0.0079,-.0108,-.0102,-.0848,
     &          0.0042,0.0031,0.0047,0.0030,0.0100,0.0116,-.0009,
     &          -.0040,-.0013,0.0003,-.0132,-.0044,-.0107,-.0026/
      data (( ys2(j,i), i=1,7), j=1,7)/7*0.,
     &          0.0032,0.0088,0.0132,0.0176,0.0104,-.0056,0.1255,
     &          0.0178,-.0050,-.0052,-.0125,0.0029,0.0075,-.0694,
     &          0.0045,0.0113,-.0020,0.0029,0.0014,-.0079,-.0289,
     &          0.0035,0.0007,0.0031,0.0054,-.0047,-.0044,-.0324,
     &          0.0008,-.0034,-.0030,-.0096,0.0068,-.0019,-.0193,
     &          -.0019,-.0015,-.0008,0.0010,-.0085,0.0019,-.0002/

      data pis12/0.261799387799/
c
c    regeneration des coeffs r0, r1, h0, h1, s0 et s2
c        t = temps magnetique local
c        il faut donner le kp desir‚, entre 0 et 6
c        et h = latitude geomagnetique "corrigee" (en DEGRES)
c
      if (kp.lt.7) then
         ikp = kp+1
      else
         ikp=7
      endif
      trad=t*pis12

      fr0= cr0(1,ikp)
      fh0= ch0(1,ikp)
      fh1= ch1(1,ikp)
      fs0= cs0(1,ikp)
      fr1= cr1(1,ikp)
      fs2= cs2(1,ikp)
      gr0= xr0(1,ikp)
      gh0= xh0(1,ikp)
      gh1= xh1(1,ikp)
      gs0= xs0(1,ikp)
      gr1= xr1(1,ikp)
      gs2= xs2(1,ikp)

      do n = 1,6
        phi=n*trad
        cfi=cos(phi)
        sfi=sin(phi)
        fr0=fr0 + cr0(n+1,ikp)*cfi + sr0(n+1,ikp)*sfi
        fh0=fh0 + ch0(n+1,ikp)*cfi + sh0(n+1,ikp)*sfi
        fh1=fh1 + ch1(n+1,ikp)*cfi + sh1(n+1,ikp)*sfi
        fs0=fs0 + cs0(n+1,ikp)*cfi + ss0(n+1,ikp)*sfi
        fr1=fr1 + cr1(n+1,ikp)*cfi + sr1(n+1,ikp)*sfi
        fs2=fs2 + cs2(n+1,ikp)*cfi + ss2(n+1,ikp)*sfi
        gr0=gr0 + xr0(n+1,ikp)*cfi + yr0(n+1,ikp)*sfi
        gh0=gh0 + xh0(n+1,ikp)*cfi + yh0(n+1,ikp)*sfi
        gh1=gh1 + xh1(n+1,ikp)*cfi + yh1(n+1,ikp)*sfi
        gs0=gs0 + xs0(n+1,ikp)*cfi + ys0(n+1,ikp)*sfi
        gr1=gr1 + xr1(n+1,ikp)*cfi + yr1(n+1,ikp)*sfi
        gs2=gs2 + xs2(n+1,ikp)*cfi + ys2(n+1,ikp)*sfi
      enddo

c*************** Calcul des fonctions d'Epstein ***********************

c
c     calcul du flux en particules integre
c
      bs1 = log((1. + exp(fh1-fh0))/2.)
      bs2 = log(2./(1. + exp(fh0-fh1)))

      s1=(fr1-fr0-fs0*(fh1-fh0)+fs0*bs1-fs2*bs2)/(bs1-bs2)
      eps = fr0 + fs0*(h-fh0) + (s1-fs0)*log((1.+exp(h-fh0))/2.)
     &          + (fs2- s1)*log((1.+exp(h-fh1))/(1.+exp(fh0-fh1)) )

c
c     calcul du flux en energie integre
c
      bx1 = log((1. + exp(gh1-gh0))/2.)
      bx2 = log(2./(1. + exp(gh0-gh1)))

      x1=(gr1-gr0-gs0*(gh1-gh0)+gs0*bx1-gs2*bx2)/(bx1-bx2)
      epx = gr0 + gs0*(h-gh0) + (x1-gs0)*log((1.+exp(h-gh0))/2.)
     &          + (gs2- x1)*log((1.+exp(h-gh1))/(1.+exp(gh0-gh1)) )

      if(h.gt.fh1) eps=max(eps,xnlimpo)
      if(h.lt.fh0) eps=max(eps,xnlimeq)
      if(h.gt.gh1) epx=max(epx,xelimpo)
      if(h.lt.gh0) epx=max(epx,xelimeq)

      return
      end
