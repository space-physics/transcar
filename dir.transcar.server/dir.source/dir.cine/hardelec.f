      subroutine hardelec(h,t,kp,eps,epx)
c
c           JGR,92, 12275-12294, NOVEMBER 1987
c
      common/cnumber/fs1,fh0,fr0,fh1,fr1,fs2
      common/enumber/gs1,gh0,gr0,gh1,gr1,gs2

      real cr0(7,7),ch0(7,7),cs1(7,7),cs2(7,7)
      real sr0(7,7),sh0(7,7),ss1(7,7),ss2(7,7)
      real xr0(7,7),xh0(7,7),xs1(7,7),xs2(7,7)
      real yr0(7,7),yh0(7,7),ys1(7,7),ys2(7,7)
      real h,t

c      xnlimeq=8.32e3*10**(0.157*kp)
c     xnlimeq=alog10(xnlimeq)
c     xelimeq=4.17e2*10**(0.126*kp)
c     xelimeq=alog10(xelimeq)
c
c     limites "poleward" inversees par rapport a l'article:
c
c     xelimpo=alog10(6.31e5)
c     xnlimpo=alog10(1.41e5)

c******   coeffs Epstein-Fourier pour le Flux de particules


      data (( cr0(j,i), i=1,7), j=1,7)/
     &          8.1810131,8.2364033,8.2909628,8.3578268,8.3971276,
     &          8.5047969,8.6517426,
     &          -.2676399,-.2463092,-.1762658,-.1294272,-.0748857,
     &          .0083346,-.0370451,
     &          -.0351920,.0309183,.0707887,.0751993,.0628215,
     &          .0003975,-.0343524,
     &          .0612769,.0624251,.0578919,.0198924,.0205632,
     &          -.0084703,-.0218729,
     &          .0101369,.0067655,-.0074973,-.0004569,-.0036976,
     &          .0282854,.0598460,
     &          .0013806,-.0020184,-.0073355,.0008590,.0088733,
     &          .0586690,.0355728,
     &          -.0012810,.0081971,.0072606,.0076890,-.0012587,
     &          -.0029402,.0345584/

      data (( sr0(j,i), i=1,7), j=1,7)/7*0.,
     &          .0589730,.0520503,.0471840,.0257314,.0378818,
     &          .0997451,.1084300,
     &          -.0037701,-.0269135,-.0301195,-.0367547,-.0547457,
     &          .0516563,-.0146683,
     &          -.0146568,-.0301697,-.0115535,.0048249,-.0270750,
     &          .0128657,-.0369367,
     &          -.0075195,-.0024391,-.0015731,.0122568,.0184307,
     &          .0177685,.0076919,
     &          -.0352166,-.0140458,-.0108186,-.0027130,-.0043656,
     &          -.0263897,-.0577212,
     &          -.0143828,.0108562,-.0060822,-.0169765,.0176435,
     &          .0337555,.0203793/

      data (( ch0(j,i), i=1,7), j=1,7)/
     &          75.7083333,74.6041667,73.250,71.3750,70.070833,
     &          68.9166667,66.8229167,
     &          -4.8242451,-5.0291482,-5.1687097,-5.5714716,-4.5498125,
     &          -4.6529356,-4.9876325,
     &          -1.4782888,-1.2117782,-.8214932,-.1557649,.3797725,
     &          .2982035,1.0101195,
     &          -.0986596,.0734319,.3027581,.3319712,-.1284269,
     &          .3985200,-1.2344040,
     &          .4653417,.3755086,.3392090,.0294626,-.3436211,
     &          -.9717052,-.9568701,
     &          .0759315,-.0527220,-.0354935,-.2520228,.0025403,
     &          .4004649,-.0705667,
     &          -.0769901,-.1586503,-.0703854,-.1792657,.0230968,
     &          -.4207092,-.3404169/

      data (( sh0(j,i), i=1,7), j=1,7)/7*0.,
     &          -.0515624,.1852949,.1283946,-.0986995,.2644732,
     &          -1.1825856,.5693895,
     &          -.3387303,-.3424098,-.5498457,-.9554075,-.7677660,
     &          -1.4195980,.0367430,
     &          -.1103123,-.3827283,-.4734041,-.4965528,-.1598880,
     &          -.2180476,-.4429932,
     &          -.1943977,-.1890056,-.2253053,.1502035,.0460054,
     &          .0531464,-.1803368,
     &          .0058707,.1369345,-.0168161,.1356316,.0616603,
     &          .5072412,.8665934,
     &          -.0703853,.1520455,.1248254,.0,-.5931432,
     &          -.5482702,-.7063537/


      data (( cs1(j,i), i=1,7), j=1,7)/
     &.2091148,.2031531,.1784281,.1944620,.1796257,.1407376,.1409136,
     &.0277581,.0023882,-.0149049,.005109,-.0451789,-.0016084,.0046305,
     &.0438852,.0542579,.0429286,.0353104,-.0056263,-.0138547,-.0171867,
     &.0217138,.0049831,-.0023471,-.0080685,.014434,-.0089796,-.0126698,
     &-.0073231,-.0060284,.0070985,.0058568,.0181576,.018692,.0302579,
     &-.0096685,.0013701,.0013795,.0018154,-.0297343,-.0135471,-.006064,
     &-.0003772,.003693,.0065824,.0058214,-.0006281,.0008712,-.0015417/
      data (( ss1(j,i), i=1,7), j=1,7)/7*0.,
     &-.0076504,-.0405273,-.0389161,-.0328608,-.0633593,.0201719,
     &-.002353,
     &.0134144,.005905,-.0104279,.010011,.0266415,.0239045,.0054035,
     &.0095689,-.0141138,-.0140684,.0137095,.0061358,.0259267,.0174821,
     &.0202667,.0207311,.0123246,.011811,-.0140902,-.012765,-.0096574,
     &.0063682,-.0033695,.0048552,.0052973,-.0079481,-.0010284,-.0218716
     &,.0146708,.0071369,.0080072,-.0043098,.0461685,-.0008266,-.0000407
     &/


      data (( cs2(j,i), i=1,7), j=1,7)/
     &-.0956275,-.0978087,-.1040591,-.0941288,-.0926478,-.0897284,
     &          -.0749910,
     &.0438939,.0439549,.0375563,.0347372,.015514,.0177229,.0159613,
     &-.0001422,-.0116659,-.0141804,-.0142468,-.0188644,-.0005569,
     &          .0008709,
     &-.0138387,-.0134314,-.0125446,-.0047589,-.0030768,-.0016517,
     &          .0038346,
     &-.0077334,-.0031075,.0029161,.0036599,.0017261,.0082788,.0030216,
     &-.0018326,.0022027,.0017729,.0020201,-.0009343,-.0087578,
     &          -.0023803,
     &.0011037,.002399,.001902,-.0020462,-.0003616,.0016466,.0005726/
      data (( ss2(j,i), i=1,7), j=1,7)/7*0.,
     &-.0032528,-.0084972,-.0017633,.0033775,-.0002402,.0073214,
     &          -.0064361,
     &.0014625,.005291,.0061491,.0099362,.0111606,.0095884,.0017862,
     &-.0012418,.0042813,.0017381,.0004723,.0003837,.0004367,.0000208,
     &.0004149,-.0009604,.0014039,-.0036687,-.0026026,-.000901,.0033954,
     &.0037899,.0007219,.0008384,-.001947,-.0018301,-.0013352,-.0001447,
     &.0030647,-.0051638,-.0015754,.002034,.0050041,.0035559,.0016903/



c******   coeffs Epstein-Fourier pour le Flux d energie


      data (( xr0(j,i), i=1,7), j=1,7)/
     &7.7896976,8.0364974,8.2850158,8.4772806,8.519581,8.525615,
     &          8.680987,
     &.0002967,.1961799,.2665715,.3651667,.4168092,.3833655,.5954141,
     &.0768187,-.0023255,.0095929,-.1059687,-.1601158,-.2472626,
     &         -.1751444,
     &.09357,.0429868,.0562738,.0324384,.007881,-.0221512,-.0089652,
     &.0028059,-.0433994,-.044498,-.013212,.0092577,-.045643,.0796042,
     &.0147765,.0277324,.0108284,.0591799,.0509579,.059123,.0257641,
     &.0021958,.002932,-.0015142,-.0081149,-.0051431,.0175221,-.0060951/
      data (( yr0(j,i), i=1,7), j=1,7)/7*0.,
     &.0462879,.0797814,.1217648,.1096211,.1571118,.0912572,.1824138,
     &.0240691,-.0235719,-.0444369,-.0351757,-.1385018,-.066892,
     &         -.0593238,
     &-.0399482,-.0169762,.0387839,.0659091,.0342856,.0040225,
     &          .0423806,
     &-.0516997,-.0148749,-.0061023,.0254995,.0149269,.0106788,
     &          .0322709,
     &-.0441358,.0137977,.0427911,-.0133701,.0042574,.0228927,
     &          -.0467562,
     &-.0008464,.0014145,-.0082458,.01453,.0350032,.001001,.0581636/

      data (( xh0(j,i), i=1,7), j=1,7)/
     &73.0708333,71.1875,70.40625,69.28125,68.6770833,67.55,66.2916667,
     &-3.3538923,-3.4878153,-3.8822697,-4.0683244,-3.7241896,-3.3575591,
     &          -4.9456659,
     &-1.0653413,-.3527452,-.3345333,-.1225232,.7259087,.4815741,
     &           .5050106,
     &1.2190125,.6444892,.6493035,-.0178301,-.0121933,-1.0500534,
     &          -.8573961,
     &-.5114249,-.6410611,-.6410611,-.635669,-.4427162,-.6766072,
     &          -.5881981,
     &-.2189668,.1732289,.2531377,-.026577,.2728201,-.054231,.2395331,
     &-.544628,-.3896202,-.0962376,-.1759633,-.0511379,-.5671779,
     &         -.2515854/
      data (( yh0(j,i), i=1,7), j=1,7)/7*0.,
     &-1.8623847,-2.5027481,-2.433572,-2.4959098,-2.0812021,-1.9088494,
     &           -1.1950328,
     &-.0758685,.3886167,.0509922,.2854165,.6227584,-.3041218,.974919,
     &.0309485,-.5568983,-.8521281,-.9594749,-.7456933,-1.1673833,
     &         -.8919033,
     &.1384184,.0725993,-.0697097,.5512278,.8020486,.4998871,.0765466,
     &.343658,-.1717545,-.3485596,.0565716,.1579351,-.5881622,-.4742351,
     &-.4349738,-.0497699,.3252729,.341218,-.2933826,-.2342528,
     &          -.3604655/


      data (( xs1(j,i), i=1,7), j=1,7)/
     &.2191803,.2490905,.2460024,.2753726,.2266293,.1829103,.1601541,
     &.0563385,.0606912,.0563624,.1151785,.0254753,.0248435,.0484496,
     &.0123579,-.0225351,-.0173165,.0234371,-.0633029,-.0355286,
     &         -.0263287,
     &-.0517093,-.0143288,-.0081089,.0314753,.0125143,.0331517,
     &          -.0067494,
     &-.0055988,.0232768,.0582433,.0288739,.0234768,.0152159,.017723,
     &.0006074,-.0054526,.0166424,-.0154872,-.0247079,-.0044664,
     &         -.0112026,
     &.0332549,.0075123,-.0085391,-.0112962,-.0249497,-.0065978,
     &         -.0211823/
      data (( ys1(j,i), i=1,7), j=1,7)/7*0.,
     &.0125471,.0401181,.030247,.0372748,.0033675,.0221958,.0270234,
     &-.0234464,.0029146,-.024644,.0397184,-.0079194,.0090232,-.005559,
     &-.0165087,.0015539,-.0103219,.0534929,.0167988,.0383684,.0197485,
     &-.0043154,-.0051051,.0129462,.0172888,-.030643,.0078454,.0147867,
     &.0084612,.01896,.0384384,-.0011013,-.012333,.0268375,.0107573,
     &.035742,.0240313,.0147419,.0037713,.0294261,.0080741,.013549/

      data (( xs2(j,i), i=1,7), j=1,7)/
     &-.0859725,-.0888827,-.1171,-.1115326,-.1344448,-.1114507,
     &          -.1060242,
     &-.039815,-.0293764,-.020077,-.0220689,-.008162,.0032621,
     &         -.0009483,
     &-.0220984,-.0113256,.0023607,.017865,.0008903,.0075126,.0041099,
     &-.0131578,-.0089596,-.0113432,-.0018842,-.0051142,.0272683,
     &          .0077486,
     &.0168468,.0217679,.0152396,.0074899,.0159459,.0233378,.0040821,
     &.0119485,.0050594,-.0013597,-.0040025,-.0182547,-.0131719,
     &         -.0099643,
     &.0146299,.0104945,.0016201,-.0021947,.0008094,.0145349,.017156/
      data (( ys2(j,i), i=1,7), j=1,7)/7*0.,
     &-.0011417,.0185842,.0199753,.0126324,.0227951,.0138889,-.0020533,
     &-.0234705,-.0027588,-.0037281,-.0011085,-.0133774,.0057275,
     &          -.0110137,
     &-.0098271,.0201468,-.0042125,-.008436,.009881,.0295801,.007815,
     &-.0043996,.006013,.0030722,-.0020236,-.0192107,-.0184993,
     &          -.0092857,
     &-.0008923,-.000057,-.0066734,-.0049755,-.0095057,.0124451,
     &          .0247198,
     &.0028314,-.0025187,-.0018083,-.0052334,.0093728,-.0054305,
     &         -.0182895/

      data pis12/0.261799387799/
c
c    regeneration des coeffs r0, r1, h0, h1, s1 et s2
c        t = temps magnetique local
c        il faut donner le kp desir‚, entre 0 et 6
c        et h = latitude geomagnetique "corrigee" (en DEGRES)
c
      if (kp.lt.7) then
         ikp = kp+1
      else
         ikp=7
      endif
      trad=t*pis12

      fr0= cr0(1,ikp)
      fh0= ch0(1,ikp)
      fs1= cs1(1,ikp)
      fs2= cs2(1,ikp)
      gr0= xr0(1,ikp)
      gh0= xh0(1,ikp)
      gs1= xs1(1,ikp)
      gs2= xs2(1,ikp)

      do n = 1,6
        phi=n*trad
        cfi=cos(phi)
        sfi=sin(phi)
        fr0=fr0 + cr0(n+1,ikp)*cfi + sr0(n+1,ikp)*sfi
        fh0=fh0 + ch0(n+1,ikp)*cfi + sh0(n+1,ikp)*sfi
        fs1=fs1 + cs1(n+1,ikp)*cfi + ss1(n+1,ikp)*sfi
        fs2=fs2 + cs2(n+1,ikp)*cfi + ss2(n+1,ikp)*sfi
        gr0=gr0 + xr0(n+1,ikp)*cfi + yr0(n+1,ikp)*sfi
        gh0=gh0 + xh0(n+1,ikp)*cfi + yh0(n+1,ikp)*sfi
        gs1=gs1 + xs1(n+1,ikp)*cfi + ys1(n+1,ikp)*sfi
        gs2=gs2 + xs2(n+1,ikp)*cfi + ys2(n+1,ikp)*sfi
      enddo

c*************** Calcul des fonctions d'Epstein ***********************

c
c     calcul du flux en particules integre
c
      eps=fr0+fs1*(h-fh0)+(fs2-fs1)*log((1.-fs1/(fs2*exp(fh0-h)))/
     &            (1.-fs1/fs2))

c
c     calcul du flux en energie integre
c
      epx=gr0+gs1*(h-gh0)+(gs2-gs1)*log((1.-gs1/(gs2*exp(gh0-h)))/
     &            (1.-gs1/gs2))

      if(h.gt.fh0) eps=max(eps,7.)
      if(h.lt.fh0) eps=max(eps,6.)
      if(h.gt.gh0) epx=max(epx,7.)
      if(h.lt.gh0) epx=max(epx,6.)

      return
      end
